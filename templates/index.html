<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RiyalGo P2P Monitor</title>
  <style>
    :root {
      --bg: #f4f7fb;
      --card: #ffffff;
      --text: #12263a;
      --muted: #5f7287;
      --accent: #0a7d3c;
      --border: #d9e3ee;
    }
    body { margin: 0; font-family: "Segoe UI", Tahoma, sans-serif; background: var(--bg); color: var(--text); }
    .wrap { max-width: 1100px; margin: 24px auto; padding: 0 16px; }
    .head { display: flex; justify-content: space-between; gap: 10px; align-items: baseline; margin-bottom: 16px; }
    .title { font-size: 24px; font-weight: 700; }
    .time { color: var(--muted); font-size: 14px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 14px; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 12px; }
    .card h3 { margin: 0 0 10px; font-size: 16px; }
    .note { color: var(--muted); font-size: 12px; margin-top: -4px; margin-bottom: 8px; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th, td { padding: 8px 6px; border-bottom: 1px solid #eef3f8; text-align: left; vertical-align: top; }
    th { color: var(--muted); font-weight: 600; }
    .seller a { color: var(--accent); text-decoration: none; font-weight: 600; }
    .seller a:hover { text-decoration: underline; }
    .empty { color: var(--muted); font-size: 13px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <div class="title">RiyalGo P2P</div>
      <div id="ts" class="time">Loading...</div>
    </div>
    <div class="grid">
      <section class="card">
        <h3>IDR BUY</h3>
        <div class="note">Filter seller: terverifikasi + volume/limit di atas 3.000.000 IDR</div>
        <div id="idr-buy"></div>
      </section>
      <section class="card">
        <h3>IDR SELL</h3>
        <div class="note">Filter seller: terverifikasi + volume/limit di atas 3.000.000 IDR</div>
        <div id="idr-sell"></div>
      </section>
      <section class="card">
        <h3>SAR BUY</h3>
        <div class="note">Filter seller: terverifikasi + volume/limit besar (setara sekitar 12.000 SAR)</div>
        <div id="sar-buy"></div>
      </section>
      <section class="card">
        <h3>SAR SELL</h3>
        <div class="note">Filter seller: terverifikasi + volume/limit besar (setara sekitar 12.000 SAR)</div>
        <div id="sar-sell"></div>
      </section>
    </div>
  </div>
  <script>
    function fmt(v) {
      const n = Number(v || 0);
      return n.toLocaleString("id-ID", { maximumFractionDigits: 2 });
    }

    function renderTable(targetId, rows, currPrefix) {
      const el = document.getElementById(targetId);
      if (!rows || rows.length === 0) {
        el.innerHTML = '<div class="empty">Tidak ada seller yang lolos filter.</div>';
        return;
      }
      const body = rows.map((r) => {
        const name = (r.name || "Seller").replace(/</g, "&lt;");
        const url = r.url || "#";
        return (
          "<tr>" +
          `<td class="seller"><a href="${url}" target="_blank" rel="noopener noreferrer">${name}</a></td>` +
          `<td>${currPrefix} ${fmt(r.price)}</td>` +
          `<td>${currPrefix} ${fmt(r.volume)}</td>` +
          "</tr>"
        );
      }).join("");
      el.innerHTML =
        "<table><thead><tr><th>Seller</th><th>Price</th><th>Limit/Volume</th></tr></thead><tbody>" +
        body +
        "</tbody></table>";
    }

    async function loadData() {
      const res = await fetch("/api/data");
      const data = await res.json();
      document.getElementById("ts").textContent = `${data.date} ${data.time} WIB`;
      renderTable("idr-buy", data.p2p_indo_buy, "Rp");
      renderTable("idr-sell", data.p2p_indo_sell, "Rp");
      renderTable("sar-buy", data.p2p_saudi_buy, "SAR");
      renderTable("sar-sell", data.p2p_saudi_sell, "SAR");
    }

    loadData();
    setInterval(loadData, 30000);
  </script>
</body>
</html>
